---
name: Update resume.carlosnunez.me
on:
  push:
    branches:
      - main
    paths:
      - 'resumes/**'
      - 'config.toml'
      - 'Dockerfile'
      - 'docker-compose.yml'
      - 'env.gpg'
      - 'scripts/deploy'
      - '.github/**'
      - '.kickCI/**'
    tags:
      - '[0-9]{4}.[0-9]{2}.[0-9]{2}'

jobs:
  update_website:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - uses: KengoTODA/actions-setup-docker-compose@v1
        with:
          version: 2.21.0

      - name: Decrypt environment file
        run: |-
          echo "Env password: ${{ secrets.env_file_encryption_key }}"
          docker-compose -f docker-compose.ci.yml run --rm decrypt-env
        env:
          ENV_PASSWORD: ${{ secrets.env_file_encryption_key }}

      - name: Install jq
        run: sudo apt-get install jq

      - name: Deploy!
        run: ./scripts/deploy
        env:
          ENV_PASSWORD: ${{ secrets.env_file_encryption_key }}
